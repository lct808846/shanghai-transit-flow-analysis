"""
为数据库中的站点更新真实的上海地铁站经纬度坐标
"""
import os
import sys
import django

sys.path.insert(0, os.path.join(os.path.dirname(__file__), '..', 'backend'))
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'transit_system.settings')
django.setup()

from analysis.models import BusStation

# 上海地铁站点的近似真实经纬度
STATION_COORDS = {
    # 1号线
    "莘庄":          (121.3857, 31.1117),
    "外环路":        (121.3954, 31.1273),
    "莲花路":        (121.4055, 31.1370),
    "锦江乐园":      (121.4126, 31.1505),
    "上海南站":       (121.4296, 31.1549),
    "漕宝路":        (121.4339, 31.1680),
    "上海体育馆":     (121.4388, 31.1824),
    "徐家汇":        (121.4369, 31.1950),
    "衡山路":        (121.4479, 31.2052),
    "常熟路":        (121.4510, 31.2147),
    "陕西南路":       (121.4559, 31.2194),
    "黄陂南路":       (121.4700, 31.2234),
    "人民广场":       (121.4737, 31.2328),
    "新闸路":        (121.4698, 31.2401),
    "汉中路":        (121.4612, 31.2462),
    "上海火车站":     (121.4561, 31.2496),
    "中山北路":       (121.4486, 31.2608),
    "延长路":        (121.4456, 31.2718),
    "上海马戏城":     (121.4456, 31.2828),
    "汶水路":        (121.4485, 31.2982),
    "彭浦新村":       (121.4522, 31.3094),
    # 2号线
    "徐泾东":        (121.2974, 31.1906),
    "虹桥火车站":     (121.3190, 31.1948),
    "虹桥2号航站楼":   (121.3245, 31.1980),
    "淞虹路":        (121.3560, 31.2155),
    "北新泾":        (121.3684, 31.2174),
    "威宁路":        (121.3819, 31.2173),
    "娄山关路":       (121.3988, 31.2145),
    "中山公园":       (121.4146, 31.2183),
    "江苏路":        (121.4299, 31.2218),
    "静安寺":        (121.4452, 31.2230),
    "南京西路":       (121.4566, 31.2289),
    # "人民广场" 已在1号线中定义
    "南京东路":       (121.4838, 31.2365),
    "陆家嘴":        (121.4993, 31.2390),
    "东昌路":        (121.5075, 31.2320),
    "世纪大道":       (121.5216, 31.2285),
    "上海科技馆":     (121.5410, 31.2192),
    "世纪公园":       (121.5498, 31.2098),
    "龙阳路":        (121.5566, 31.2030),
    "张江高科":       (121.5830, 31.2034),
    # 10号线
    # "虹桥火车站" 已在2号线中定义
    "虹桥1号航站楼":   (121.3361, 31.1934),
    "上海动物园":     (121.3669, 31.1924),
    "龙溪路":        (121.3752, 31.2009),
    "水城路":        (121.3848, 31.2063),
    "伊犁路":        (121.3942, 31.2061),
    "宋园路":        (121.4036, 31.2064),
    "虹桥路":        (121.4211, 31.2006),
    "交通大学":       (121.4326, 31.2005),
    "上海图书馆":     (121.4427, 31.2118),
    # "陕西南路" 已在1号线中定义
    "新天地":        (121.4736, 31.2172),
    "老西门":        (121.4819, 31.2154),
    "豫园":          (121.4893, 31.2271),
    # "南京东路" 已在2号线中定义
    "天潼路":        (121.4860, 31.2429),
    "四川北路":       (121.4838, 31.2524),
    "海伦路":        (121.4895, 31.2612),
}


def update_coordinates():
    """更新数据库中所有站点的经纬度"""
    updated = 0
    not_found = []

    stations = BusStation.objects.all()
    for station in stations:
        name = station.station_name
        if name in STATION_COORDS:
            lon, lat = STATION_COORDS[name]
            station.longitude = lon
            station.latitude = lat
            station.save(update_fields=['longitude', 'latitude'])
            updated += 1
            print(f"  ✓ {name}: ({lon}, {lat})")
        else:
            not_found.append(name)

    print(f"\n已更新 {updated} 个站点坐标")
    if not_found:
        print(f"未找到坐标的站点: {not_found}")


if __name__ == '__main__':
    print("=" * 60)
    print("  更新站点经纬度坐标")
    print("=" * 60)
    update_coordinates()
    print("\n完成！")
